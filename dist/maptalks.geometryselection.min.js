/*!
 * maptalks.geometryselection v0.1.0-alpha.2
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var te="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var e,ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=(function(t,e){var n="__lodash_hash_undefined__",m=1,v=2,r=9007199254740991,b="[object Arguments]",g="[object Array]",o="[object AsyncFunction]",j="[object Boolean]",w="[object Date]",O="[object Error]",i="[object Function]",a="[object GeneratorFunction]",S="[object Map]",k="[object Number]",s="[object Null]",A="[object Object]",u="[object Promise]",c="[object Proxy]",E="[object RegExp]",z="[object Set]",G="[object String]",P="[object Symbol]",f="[object Undefined]",l="[object WeakMap]",D="[object ArrayBuffer]",T="[object DataView]",h=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,y={};y["[object Float32Array]"]=y["[object Float64Array]"]=y["[object Int8Array]"]=y["[object Int16Array]"]=y["[object Int32Array]"]=y["[object Uint8Array]"]=y["[object Uint8ClampedArray]"]=y["[object Uint16Array]"]=y["[object Uint32Array]"]=!0,y[b]=y[g]=y[D]=y[j]=y[T]=y[w]=y[O]=y[i]=y[S]=y[k]=y[A]=y[E]=y[z]=y[G]=y[l]=!1;var _="object"==ee(te)&&te&&te.Object===Object&&te,d="object"==("undefined"==typeof self?"undefined":ee(self))&&self&&self.Object===Object&&self,C=_||d||Function("return this")(),x=e&&!e.nodeType&&e,F=x&&t&&!t.nodeType&&t,L=F&&F.exports===x,M=L&&_.process,I=function(){try{return M&&M.binding&&M.binding("util")}catch(t){}}(),U=I&&I.isTypedArray;function H(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function $(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function N(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var W,R,B,J=Array.prototype,V=Function.prototype,X=Object.prototype,Y=C["__core-js_shared__"],Z=V.toString,q=X.hasOwnProperty,K=(W=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",Q=X.toString,tt=RegExp("^"+Z.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=L?C.Buffer:void 0,rt=C.Symbol,nt=C.Uint8Array,ot=X.propertyIsEnumerable,it=J.splice,at=rt?rt.toStringTag:void 0,st=Object.getOwnPropertySymbols,ut=et?et.isBuffer:void 0,ct=(R=Object.keys,B=Object,function(t){return R(B(t))}),ft=It(C,"DataView"),lt=It(C,"Map"),ht=It(C,"Promise"),pt=It(C,"Set"),yt=It(C,"WeakMap"),_t=It(Object,"create"),dt=Nt(ft),vt=Nt(lt),bt=Nt(ht),gt=Nt(pt),mt=Nt(yt),jt=rt?rt.prototype:void 0,wt=jt?jt.valueOf:void 0;function Ot(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function St(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function kt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function At(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new kt;++e<r;)this.add(t[e])}function Et(t){var e=this.__data__=new St(t);this.size=e.size}function zt(t,e){var r=Bt(t),n=!r&&Rt(t),o=!r&&!n&&Jt(t),i=!r&&!n&&!o&&Kt(t),a=r||n||o||i,s=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=s.length;for(var c in t)!e&&!q.call(t,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||$t(c,u))||s.push(c);return s}function Gt(t,e){for(var r=t.length;r--;)if(Wt(t[r][0],e))return r;return-1}function Pt(t){return null==t?void 0===t?f:s:at&&at in Object(t)?function(t){var e=q.call(t,at),r=t[at];try{var n=!(t[at]=void 0)}catch(t){}var o=Q.call(t);n&&(e?t[at]=r:delete t[at]);return o}(t):function(t){return Q.call(t)}(t)}function Dt(t){return Zt(t)&&Pt(t)==b}function Tt(t,e,r,n,o){return t===e||(null==t||null==e||!Zt(t)&&!Zt(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var a=Bt(t),s=Bt(e),u=a?g:Ht(t),c=s?g:Ht(e),f=(u=u==b?A:u)==A,l=(c=c==b?A:c)==A,h=u==c;if(h&&Jt(t)){if(!Jt(e))return!1;f=!(a=!0)}if(h&&!f)return i||(i=new Et),a||Kt(t)?Ft(t,e,r,n,o,i):function(t,e,r,n,o,i,a){switch(r){case T:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case D:return!(t.byteLength!=e.byteLength||!i(new nt(t),new nt(e)));case j:case w:case k:return Wt(+t,+e);case O:return t.name==e.name&&t.message==e.message;case E:case G:return t==e+"";case S:var s=$;case z:var u=n&m;if(s||(s=N),t.size!=e.size&&!u)return!1;var c=a.get(t);if(c)return c==e;n|=v,a.set(t,e);var f=Ft(s(t),s(e),n,o,i,a);return a.delete(t),f;case P:if(wt)return wt.call(t)==wt.call(e)}return!1}(t,e,u,r,n,o,i);if(!(r&m)){var p=f&&q.call(t,"__wrapped__"),y=l&&q.call(e,"__wrapped__");if(p||y){var _=p?t.value():t,d=y?e.value():e;return i||(i=new Et),o(_,d,r,n,i)}}return h&&(i||(i=new Et),function(t,e,r,n,o,i){var a=r&m,s=Lt(t),u=s.length,c=Lt(e).length;if(u!=c&&!a)return!1;var f=u;for(;f--;){var l=s[f];if(!(a?l in e:q.call(e,l)))return!1}var h=i.get(t);if(h&&i.get(e))return h==e;var p=!0;i.set(t,e),i.set(e,t);var y=a;for(;++f<u;){l=s[f];var _=t[l],d=e[l];if(n)var v=a?n(d,_,l,e,t,i):n(_,d,l,t,e,i);if(!(void 0===v?_===d||o(_,d,r,n,i):v)){p=!1;break}y||(y="constructor"==l)}if(p&&!y){var b=t.constructor,g=e.constructor;b!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g)&&(p=!1)}return i.delete(t),i.delete(e),p}(t,e,r,n,o,i))}(t,e,r,n,Tt,o))}function Ct(t){return!(!Yt(t)||function(t){return!!K&&K in t}(t))&&(Vt(t)?tt:h).test(Nt(t))}function xt(t){if(!function(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||X;return t===r}(t))return ct(t);var e=[];for(var r in Object(t))q.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Ft(t,e,n,o,i,a){var r=n&m,s=t.length,u=e.length;if(s!=u&&!(r&&s<u))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var f=-1,l=!0,h=n&v?new At:void 0;for(a.set(t,e),a.set(e,t);++f<s;){var p=t[f],y=e[f];if(o)var _=r?o(y,p,f,e,t,a):o(p,y,f,t,e,a);if(void 0!==_){if(_)continue;l=!1;break}if(h){if(!H(e,function(t,e){if(r=e,!h.has(r)&&(p===t||i(p,t,n,o,a)))return h.push(e);var r})){l=!1;break}}else if(p!==y&&!i(p,y,n,o,a)){l=!1;break}}return a.delete(t),a.delete(e),l}function Lt(t){return function(t,e,r){var n=e(t);return Bt(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,Qt,Ut)}function Mt(t,e){var r=t.__data__;return function(t){var e=void 0===t?"undefined":ee(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function It(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Ct(r)?r:void 0}Ot.prototype.clear=function(){this.__data__=_t?_t(null):{},this.size=0},Ot.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ot.prototype.get=function(t){var e=this.__data__;if(_t){var r=e[t];return r===n?void 0:r}return q.call(e,t)?e[t]:void 0},Ot.prototype.has=function(t){var e=this.__data__;return _t?void 0!==e[t]:q.call(e,t)},Ot.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=_t&&void 0===e?n:e,this},St.prototype.clear=function(){this.__data__=[],this.size=0},St.prototype.delete=function(t){var e=this.__data__,r=Gt(e,t);return!(r<0)&&(r==e.length-1?e.pop():it.call(e,r,1),--this.size,!0)},St.prototype.get=function(t){var e=this.__data__,r=Gt(e,t);return r<0?void 0:e[r][1]},St.prototype.has=function(t){return-1<Gt(this.__data__,t)},St.prototype.set=function(t,e){var r=this.__data__,n=Gt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},kt.prototype.clear=function(){this.size=0,this.__data__={hash:new Ot,map:new(lt||St),string:new Ot}},kt.prototype.delete=function(t){var e=Mt(this,t).delete(t);return this.size-=e?1:0,e},kt.prototype.get=function(t){return Mt(this,t).get(t)},kt.prototype.has=function(t){return Mt(this,t).has(t)},kt.prototype.set=function(t,e){var r=Mt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},At.prototype.add=At.prototype.push=function(t){return this.__data__.set(t,n),this},At.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.clear=function(){this.__data__=new St,this.size=0},Et.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Et.prototype.get=function(t){return this.__data__.get(t)},Et.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.set=function(t,e){var r=this.__data__;if(r instanceof St){var n=r.__data__;if(!lt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new kt(n)}return r.set(t,e),this.size=r.size,this};var Ut=st?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}(st(e),function(t){return ot.call(e,t)}))}:function(){return[]},Ht=Pt;function $t(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||p.test(t))&&-1<t&&t%1==0&&t<e}function Nt(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Wt(t,e){return t===e||t!=t&&e!=e}(ft&&Ht(new ft(new ArrayBuffer(1)))!=T||lt&&Ht(new lt)!=S||ht&&Ht(ht.resolve())!=u||pt&&Ht(new pt)!=z||yt&&Ht(new yt)!=l)&&(Ht=function(t){var e=Pt(t),r=e==A?t.constructor:void 0,n=r?Nt(r):"";if(n)switch(n){case dt:return T;case vt:return S;case bt:return u;case gt:return z;case mt:return l}return e});var Rt=Dt(function(){return arguments}())?Dt:function(t){return Zt(t)&&q.call(t,"callee")&&!ot.call(t,"callee")},Bt=Array.isArray;var Jt=ut||function(){return!1};function Vt(t){if(!Yt(t))return!1;var e=Pt(t);return e==i||e==a||e==o||e==c}function Xt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=r}function Yt(t){var e=void 0===t?"undefined":ee(t);return null!=t&&("object"==e||"function"==e)}function Zt(t){return null!=t&&"object"==(void 0===t?"undefined":ee(t))}var qt,Kt=U?(qt=U,function(t){return qt(t)}):function(t){return Zt(t)&&Xt(t.length)&&!!y[Pt(t)]};function Qt(t){return function(t){return null!=t&&Xt(t.length)&&!Vt(t)}(t)?zt(t):xt(t)}t.exports=function(t,e){return Tt(t,e)}}(e={exports:{}},e.exports),e.exports),a=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function r(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?n(t[1],t[2],"===",!1):"!="===e?n(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?n(t[1],t[2],e,!0):"any"===e?o(t.slice(1),"||"):"all"===e?o(t.slice(1),"&&"):"none"===e?f(o(t.slice(1),"||")):"in"===e?u(t[1],t.slice(2)):"!in"===e?f(u(t[1],t.slice(2))):"has"===e?c(t[1]):"!has"===e?f(c(t[1])):"true")+")"}function s(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function n(t,e,r,n){var o=s(t),i="$type"===t?a.indexOf(e):JSON.stringify(e);return(n?"typeof "+o+"=== typeof "+i+"&&":"")+o+r+i}function o(t,e){return t.map(r).join(e)}function u(t,e){"$type"===t&&(e=e.map(function(t){return a.indexOf(t)}));var r=JSON.stringify(e.sort(l)),n=s(t);return e.length<=200?r+".indexOf("+n+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+n+", "+r+",0,"+(e.length-1)+")"}function c(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function f(t){return"!("+t+")"}function l(t,e){return t<e?-1:e<t?1:0}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var p,y="geometryselection@cXiaof",_=(h(d,p=maptalks.Eventable(maptalks.Class)),d.prototype.addTo=function(t){return t&&(t._map_tool&&t._map_tool.disable(),this._map=t,this._newDedicatedLayer()),this},d.prototype.getMap=function(){return this._map},d.prototype.enable=function(){return this._enabled=!0,this._registerEvents(),this._layer&&this._layer.show(),this.fire("enable"),this},d.prototype.disable=function(){return this._enabled&&(this._enabled=!1,this._offMapEvents(),this._layer&&this._layer.hide(),this.fire("disable")),this},d.prototype.toggleEnable=function(){return this._enabled?this.disable():this.enable(),this},d.prototype.isEnabled=function(){return!!this._enabled},d.prototype.getGeometries=function(){return this._geometries||[]},d.prototype.forEach=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1},o=arguments[1];return this._isFn(n)&&this._geometries.forEach(function(t,e,r){o?n.call(o,t,e,r):n(t,e,r)}),this},d.prototype.filter=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1},n=arguments[1],o=this._isFn(t),i=o?t:function(t){return new Function("f","var p = (f && f.properties || {}); return "+r(t))}(t);return this._geometries.filter(function(t,e,r){return t=o?t:function(t){var e=t._toJSON(),r=e.feature;return r.type=a.indexOf(r.geometry.type),r.subType=e.subType,r}(t),n?i.call(n,t,e,r):i(t,e,r)})},d.prototype.clear=function(){this._layer&&this._layer.clear(),this._geometries=[]},d.prototype.remove=function(){return this.disable(),this._layer&&this._layer.remove(),delete this.hitGeo,delete this._layer,delete this._layerId,delete this._enabled,delete this._markerStyleDefault,delete this._map,delete this._geometries,delete this._mousemove,delete this._click,this},d.prototype._setDefaultChosenGeos=function(t){this._geometries=this._isArrayHasData(t)?t:[]},d.prototype._newDedicatedLayer=function(){this._layer=new maptalks.VectorLayer(this._layerId),this._layer.addTo(this._map).bringToFront()},d.prototype._isFn=function(t){return maptalks.Util.isFunction(t)},d.prototype._isArrayHasData=function(t){return maptalks.Util.isArrayHasData(t)},d.prototype._registerEvents=function(){var t=this.options.layers;if(this._isArrayHasData(t)){var e=this._map;this._mousemove=this._mousemoveEvents.bind(this),this._click=this._clickEvents.bind(this),e.on("mousemove",this._mousemove,this),e.on("click",this._click,this)}},d.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},d.prototype._mousemoveEvents=function(t){var r=this,e=t.target,n=t.coordinate,o=this.options.layers;e.identify({coordinate:n,tolerance:1e-4,layers:o},function(t){var e=t.reduce(function(t,e){return t||(r._isAvailTypes(e)?e:t)},null);r.hitGeo=e,r._showCopyHitGeo()})},d.prototype._isAvailTypes=function(t){var e=this.options.availTypes;if("*"===e)return!0;if(!this._isArrayHasData(e))return!1;var r=t.getType();return e.reduce(function(t,e){return t||r.endsWith(e)},!1)},d.prototype._showCopyHitGeo=function(t){this._layer||this._newDedicatedLayer();var e="__hit__"+y,r=this._layer.getGeometryById(e);if(r&&r.remove(),this.hitGeo){this.fire("hit",this.hitGeo);var n=this._getSymbolOrDefault("Hit",this.hitGeo);this._copyGeoUpdateSymbol(n,this.hitGeo).setId(e)}},d.prototype._getSymbolOrDefault=function(t,e){var r=e.getSymbol(),n=e.getType(),o=this.options["color"+t];if(r){for(var i in r)(i.endsWith("Fill")||i.endsWith("Color"))&&(r[i]=o);r.lineWidth=4}else r=n.endsWith("Point")?Object.assign(this._markerStyleDefault,{markerFill:o}):{lineColor:o,lineWidth:4};return r},d.prototype._copyGeoUpdateSymbol=function(t,e){return e.copy().updateSymbol(t).addTo(this._layer)},d.prototype._clickEvents=function(){var n=this;if(this.hitGeo){var o=this._getSafeCoords(this.hitGeo),t=this._geometries.reduce(function(t,e){var r=n._getSafeCoords(e);return i(o,r)?t:[].concat(t,[e])},[]);t.length===this._geometries.length?(this.fire("choose",this.hitGeo),this.hitGeo.copy(),this._geometries.push(this.hitGeo)):this._geometries=t,this._renderChosenGeos()}},d.prototype._getSafeCoords=function(t){var e=t.options,r=(t=t.copy()).getCoordinates();return e.numberOfShellPoints&&(e.numberOfShellPoints*=4,t.setOptions(e),r=[t.getShell()]),r},d.prototype._renderChosenGeos=function(){var r=this;this._layer?this._layer.clear():this._newDedicatedLayer(),this._geometries.forEach(function(t){var e=r._getSymbolOrDefault("Chosen",t);r._copyGeoUpdateSymbol(e,t)})},d);function d(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,p.call(this,t));return r._layerId=maptalks.INTERNAL_LAYER_PREFIX+y,r._enabled=!1,r._setDefaultChosenGeos(e),r._markerStyleDefault={markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},r}_.mergeOptions({layers:[],availTypes:"*",colorHit:"#ffa400",colorChosen:"#00bcd4"}),t.GeometrySelection=_,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.geometryselection v0.1.0-alpha.2")});
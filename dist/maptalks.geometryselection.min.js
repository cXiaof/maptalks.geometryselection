/*!
 * maptalks.geometryselection v0.1.0-beta.1
 * LICENSE : MIT
 * (c) 2016-2021 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var Ut="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var e,Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=(function(t,e){var n="__lodash_hash_undefined__",b=1,_=2,h=9007199254740991,f="[object Arguments]",p="[object Array]",r="[object AsyncFunction]",y="[object Boolean]",d="[object Date]",v="[object Error]",o="[object Function]",i="[object GeneratorFunction]",g="[object Map]",m="[object Number]",s="[object Null]",j="[object Object]",a="[object Promise]",u="[object Proxy]",w="[object RegExp]",O="[object Set]",S="[object String]",k="[object Symbol]",c="[object Undefined]",l="[object WeakMap]",A="[object ArrayBuffer]",E="[object DataView]",z=/^\[object .+?Constructor\]$/,G=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[f]=P[p]=P[A]=P[y]=P[E]=P[d]=P[v]=P[o]=P[g]=P[m]=P[j]=P[w]=P[O]=P[S]=P[l]=!1;var T="object"==Ht(Ut)&&Ut&&Ut.Object===Object&&Ut,C="object"==("undefined"==typeof self?"undefined":Ht(self))&&self&&self.Object===Object&&self,D=T||C||Function("return this")(),x=e&&!e.nodeType&&e,F=x&&t&&!t.nodeType&&t,L=F&&F.exports===x,M=L&&T.process,C=function(){try{return M&&M.binding&&M.binding("util")}catch(t){}}(),e=C&&C.isTypedArray;function I(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function U(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var H,$,F=Array.prototype,x=Function.prototype,N=Object.prototype,T=D["__core-js_shared__"],W=x.toString,R=N.hasOwnProperty,B=(C=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",J=N.toString,V=RegExp("^"+W.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),x=L?D.Buffer:void 0,T=D.Symbol,X=D.Uint8Array,q=N.propertyIsEnumerable,Y=F.splice,Z=T?T.toStringTag:void 0,K=Object.getOwnPropertySymbols,C=x?x.isBuffer:void 0,Q=(H=Object.keys,$=Object,function(t){return H($(t))}),L=St(D,"DataView"),tt=St(D,"Map"),F=St(D,"Promise"),x=St(D,"Set"),D=St(D,"WeakMap"),et=St(Object,"create"),rt=Et(L),nt=Et(tt),ot=Et(F),it=Et(x),st=Et(D),T=T?T.prototype:void 0,at=T?T.valueOf:void 0;function ut(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ct(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function lt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ft(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new lt;++e<r;)this.add(t[e])}function ht(t){t=this.__data__=new ct(t);this.size=t.size}function pt(t,e){var r,n,o,i=Pt(t),s=!i&&Gt(t),a=!i&&!s&&Tt(t),u=!i&&!s&&!a&&Mt(t),c=i||s||a||u,l=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],f=l.length;for(r in t)!e&&!R.call(t,r)||c&&("length"==r||a&&("offset"==r||"parent"==r)||u&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(n=r,!!(o=null==(o=f)?h:o)&&("number"==typeof n||G.test(n))&&-1<n&&n%1==0&&n<o))||l.push(r);return l}function yt(t,e){for(var r=t.length;r--;)if(zt(t[r][0],e))return r;return-1}function _t(t,e,r){e=e(t);return Pt(t)?e:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(e,r(t))}function dt(t){return null==t?void 0===t?c:s:Z&&Z in Object(t)?function(t){var e=R.call(t,Z),r=t[Z];try{var n=!(t[Z]=void 0)}catch(t){}var o=J.call(t);n&&(e?t[Z]=r:delete t[Z]);return o}(t):(t=t,J.call(t))}function vt(t){return Ft(t)&&dt(t)==f}function bt(t,e,r,n,o){return t===e||(null==t||null==e||!Ft(t)&&!Ft(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var s=Pt(t),a=Pt(e),u=s?p:At(t),c=a?p:At(e),l=(u=u==f?j:u)==j,a=(c=c==f?j:c)==j,c=u==c;if(c&&Tt(t)){if(!Tt(e))return!1;l=!(s=!0)}if(c&&!l)return i=i||new ht,s||Mt(t)?jt(t,e,r,n,o,i):function(t,e,r,n,o,i,s){switch(r){case E:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case A:return t.byteLength==e.byteLength&&i(new X(t),new X(e))?!0:!1;case y:case d:case m:return zt(+t,+e);case v:return t.name==e.name&&t.message==e.message;case w:case S:return t==e+"";case g:var a=I;case O:var u=n&b;if(a=a||U,t.size!=e.size&&!u)return!1;u=s.get(t);if(u)return u==e;n|=_,s.set(t,e);a=jt(a(t),a(e),n,o,i,s);return s.delete(t),a;case k:if(at)return at.call(t)==at.call(e)}return!1}(t,e,u,r,n,o,i);if(!(r&b)){l=l&&R.call(t,"__wrapped__"),a=a&&R.call(e,"__wrapped__");if(l||a){l=l?t.value():t,a=a?e.value():e;return i=i||new ht,o(l,a,r,n,i)}}return c&&(i=i||new ht,function(t,e,r,n,o,i){var s=r&b,a=wt(t),u=a.length,c=wt(e).length;if(u!=c&&!s)return!1;var l=u;for(;l--;){var f=a[l];if(!(s?f in e:R.call(e,f)))return!1}var h=i.get(t);if(h&&i.get(e))return h==e;var p=!0;i.set(t,e),i.set(e,t);var y=s;for(;++l<u;){f=a[l];var _,d=t[f],v=e[f];if(!(void 0===(_=n?s?n(v,d,f,e,t,i):n(d,v,f,t,e,i):_)?d===v||o(d,v,r,n,i):_)){p=!1;break}y=y||"constructor"==f}p&&!y&&(c=t.constructor,h=e.constructor,c!=h&&"constructor"in t&&"constructor"in e&&!("function"==typeof c&&c instanceof c&&"function"==typeof h&&h instanceof h)&&(p=!1));return i.delete(t),i.delete(e),p}(t,e,r,n,o,i))}(t,e,r,n,bt,o))}function gt(t){var e;return xt(t)&&(e=t,!(B&&B in e))&&(Ct(t)?V:z).test(Et(t))}function mt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||N,e!==r)return Q(t);var e,r,n,o=[];for(n in Object(t))R.call(t,n)&&"constructor"!=n&&o.push(n);return o}function jt(t,e,n,o,i,s){var r=n&b,a=t.length,u=e.length;if(a!=u&&!(r&&a<u))return!1;u=s.get(t);if(u&&s.get(e))return u==e;var c=-1,l=!0,f=n&_?new ft:void 0;for(s.set(t,e),s.set(e,t);++c<a;){var h,p=t[c],y=e[c];if(void 0!==(h=o?r?o(y,p,c,e,t,s):o(p,y,c,t,e,s):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return r=e,!f.has(r)&&(p===t||i(p,t,n,o,s))&&f.push(e);var r})){l=!1;break}}else if(p!==y&&!i(p,y,n,o,s)){l=!1;break}}return s.delete(t),s.delete(e),l}function wt(t){return _t(t,It,kt)}function Ot(t,e){var r,n=t.__data__;return("string"==(t=void 0===(r=e)?"undefined":Ht(r))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function St(t,e){e=e,e=null==(t=t)?void 0:t[e];return gt(e)?e:void 0}ut.prototype.clear=function(){this.__data__=et?et(null):{},this.size=0},ut.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},ut.prototype.get=function(t){var e=this.__data__;if(et){var r=e[t];return r===n?void 0:r}return R.call(e,t)?e[t]:void 0},ut.prototype.has=function(t){var e=this.__data__;return et?void 0!==e[t]:R.call(e,t)},ut.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=et&&void 0===e?n:e,this},ct.prototype.clear=function(){this.__data__=[],this.size=0},ct.prototype.delete=function(t){var e=this.__data__;return!((t=yt(e,t))<0)&&(t==e.length-1?e.pop():Y.call(e,t,1),--this.size,!0)},ct.prototype.get=function(t){var e=this.__data__;return(t=yt(e,t))<0?void 0:e[t][1]},ct.prototype.has=function(t){return-1<yt(this.__data__,t)},ct.prototype.set=function(t,e){var r=this.__data__,n=yt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},lt.prototype.clear=function(){this.size=0,this.__data__={hash:new ut,map:new(tt||ct),string:new ut}},lt.prototype.delete=function(t){return t=Ot(this,t).delete(t),this.size-=t?1:0,t},lt.prototype.get=function(t){return Ot(this,t).get(t)},lt.prototype.has=function(t){return Ot(this,t).has(t)},lt.prototype.set=function(t,e){var r=Ot(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},ft.prototype.add=ft.prototype.push=function(t){return this.__data__.set(t,n),this},ft.prototype.has=function(t){return this.__data__.has(t)},ht.prototype.clear=function(){this.__data__=new ct,this.size=0},ht.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},ht.prototype.get=function(t){return this.__data__.get(t)},ht.prototype.has=function(t){return this.__data__.has(t)},ht.prototype.set=function(t,e){var r=this.__data__;if(r instanceof ct){var n=r.__data__;if(!tt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new lt(n)}return r.set(t,e),this.size=r.size,this};var kt=K?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i}(K(e),function(t){return q.call(e,t)}))}:function(){return[]},At=dt;function Et(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(t,e){return t===e||t!=t&&e!=e}(L&&At(new L(new ArrayBuffer(1)))!=E||tt&&At(new tt)!=g||F&&At(F.resolve())!=a||x&&At(new x)!=O||D&&At(new D)!=l)&&(At=function(t){var e=dt(t),t=e==j?t.constructor:void 0,t=t?Et(t):"";if(t)switch(t){case rt:return E;case nt:return g;case ot:return a;case it:return O;case st:return l}return e});var Gt=vt(function(){return arguments}())?vt:function(t){return Ft(t)&&R.call(t,"callee")&&!q.call(t,"callee")},Pt=Array.isArray;var Tt=C||function(){return!1};function Ct(t){if(xt(t)){t=dt(t);return t==o||t==i||t==r||t==u}}function Dt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=h}function xt(t){var e=void 0===t?"undefined":Ht(t);return null!=t&&("object"==e||"function"==e)}function Ft(t){return null!=t&&"object"==(void 0===t?"undefined":Ht(t))}var Lt,Mt=e?(Lt=e,function(t){return Lt(t)}):function(t){return Ft(t)&&Dt(t.length)&&!!P[dt(t)]};function It(t){return(null!=(e=t)&&Dt(e.length)&&!Ct(e)?pt:mt)(t);var e}t.exports=function(t,e){return bt(t,e)}}(e={exports:{}},e.exports),e.exports),u=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function r(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?n(t[1],t[2],"===",!1):"!="===e?n(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?n(t[1],t[2],e,!0):"any"===e?o(t.slice(1),"||"):"all"===e?o(t.slice(1),"&&"):"none"===e?l(o(t.slice(1),"||")):"in"===e?a(t[1],t.slice(2)):"!in"===e?l(a(t[1],t.slice(2))):"has"===e?c(t[1]):"!has"===e?l(c(t[1])):"true")+")"}function s(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function n(t,e,r,n){var o=s(t),e="$type"===t?u.indexOf(e):JSON.stringify(e);return(n?"typeof "+o+"=== typeof "+e+"&&":"")+o+r+e}function o(t,e){return t.map(r).join(e)}function a(t,e){"$type"===t&&(e=e.map(function(t){return u.indexOf(t)}));var r=JSON.stringify(e.sort(f)),t=s(t);return e.length<=200?r+".indexOf("+t+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+t+", "+r+",0,"+(e.length-1)+")"}function c(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function l(t){return"!("+t+")"}function f(t,e){return t<e?-1:e<t?1:0}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var p,y="geometryselection@cXiaof",_={markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},d=(h(v,p=maptalks.Eventable(maptalks.Class)),v.prototype.addTo=function(t){return t&&(t._map_tool&&t._map_tool.disable(),this._map=t,this._newDedicatedLayer()),this},v.prototype.getMap=function(){return this._map},v.prototype.enable=function(){return this._enabled=!0,this._registerEvents(),this._layer&&this._layer.show(),this.fire("enable"),this},v.prototype.disable=function(){return this._enabled&&(this._enabled=!1,this._offMapEvents(),this._layer&&this._layer.hide(),this.fire("disable")),this},v.prototype.toggleEnable=function(){return this._enabled?this.disable():this.enable()},v.prototype.isEnabled=function(){return!!this._enabled},v.prototype.getGeometries=function(){return this._geometries||[]},v.prototype.forEach=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1},o=arguments[1];return this._isFn(n)&&this._geometries.forEach(function(t,e,r){o?n.call(o,t,e,r):n(t,e,r)}),this},v.prototype.filter=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1},i=arguments[1],s=this._isFn(t),a=s?t:new Function("f","var p = (f && f.properties || {}); return "+r(t));return this._geometries.filter(function(t,e,r){var n,o;return t=s?t:((n=(o=(n=t)._toJSON()).feature).type=u.indexOf(n.geometry.type),n.subType=o.subType,n),i?a.call(i,t,e,r):a(t,e,r)})},v.prototype.clear=function(){this._layer&&this._layer.clear(),this._geometries=[]},v.prototype.remove=function(){return this.disable(),this._layer&&this._layer.remove(),delete this.hitGeo,delete this._layer,delete this._layerId,delete this._enabled,delete this._map,delete this._geometries,this},v.prototype._isArrayHasData=function(t){return maptalks.Util.isArrayHasData(t)},v.prototype._isFn=function(t){return maptalks.Util.isFunction(t)},v.prototype._setDefaultChosenGeos=function(t){this._geometries=this._isArrayHasData(t)?t:[]},v.prototype._newDedicatedLayer=function(){this._layer=new maptalks.VectorLayer(this._layerId),this._layer.addTo(this._map).bringToFront()},v.prototype._registerEvents=function(){var t=this.options.layers;this._isArrayHasData(t)&&(this._map.on("mousemove",this._mousemoveEvents,this),this._map.on("click",this._clickEvents,this))},v.prototype._offMapEvents=function(){this._map.off("mousemove",this._mousemoveEvents,this),this._map.off("click",this._clickEvents,this)},v.prototype._mousemoveEvents=function(t){var r=this,e=t.target,n=t.coordinate,t=this.options.layers;e.identify({coordinate:n,tolerance:1e-4,layers:t},function(t){t=t.reduce(function(t,e){return t||(r._isAvailTypes(e)?e:t)},null);r.hitGeo=t,r._showCopyHitGeo()})},v.prototype._isAvailTypes=function(t){var e=this.options.availTypes;if("*"===e)return!0;if(!this._isArrayHasData(e))return!1;var r=t.getType();return e.some(function(t,e){return t||r.endsWith(e)})},v.prototype._showCopyHitGeo=function(){this._layer||this._newDedicatedLayer();var t="__hit__"+y,e=this._layer.getGeometryById(t);e&&e.remove(),this.hitGeo&&(this.fire("hit",this.hitGeo),e=this._getSymbolOrDefault("Hit",this.hitGeo),this._copyGeoUpdateSymbol(e,this.hitGeo).setId(t))},v.prototype._getSymbolOrDefault=function(t,e){var r=e.getSymbol(),e=e.getType(),n=this.options["color"+t];if(r){for(var o in r)(o.endsWith("Fill")||o.endsWith("Color"))&&(r[o]=n);r.lineWidth=4}else r=e.endsWith("Point")?Object.assign(_,{markerFill:n}):{lineColor:n,lineWidth:4};return r},v.prototype._copyGeoUpdateSymbol=function(t,e){return e.copy().updateSymbol(t).addTo(this._layer)},v.prototype._clickEvents=function(){var n,t,o=this;this.hitGeo&&(n=this._getSafeCoords(this.hitGeo),(t=this._geometries.reduce(function(t,e){var r=o._getSafeCoords(e);return i(n,r)?t:[].concat(t,[e])},[])).length===this._geometries.length?(this.fire("choose",this.hitGeo),this.hitGeo.copy(),this._geometries.push(this.hitGeo)):this._geometries=t,this._renderChosenGeos())},v.prototype._getSafeCoords=function(t){var e=t.options,r=(t=t.copy()).getCoordinates();return e.numberOfShellPoints&&(e.numberOfShellPoints*=4,t.setOptions(e),r=[t.getShell()]),r},v.prototype._renderChosenGeos=function(){var r=this;this._layer?this._layer.clear():this._newDedicatedLayer(),this._geometries.forEach(function(t){var e=r._getSymbolOrDefault("Chosen",t);r._copyGeoUpdateSymbol(e,t)})},v);function v(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,v);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,p.call(this,t));return t._layerId=""+maptalks.INTERNAL_LAYER_PREFIX+y,t._enabled=!1,t._setDefaultChosenGeos(e),t}d.mergeOptions({layers:[],availTypes:"*",colorHit:"#ffa400",colorChosen:"#00bcd4"}),t.GeometrySelection=d,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.geometryselection v0.1.0-beta.1, requires maptalks@>=0.31.0.")});